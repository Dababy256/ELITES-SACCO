<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Elites SACCO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            gold: '#B08D57',
            goldlight: '#F3E9D2',
            dark: '#111111'
          }
        }
      }
    }
  </script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-goldlight">
<div id="root"></div>

<script type="text/babel">

const MEMBERS = ["Gerald","Member 2","Member 3","Member 4","Member 5"];
const ADMIN_PIN = "1234";

function App(){
  const [user,setUser]=React.useState(null);
  const [data,setData]=React.useState({});
  const [frozen,setFrozen]=React.useState(localStorage.getItem("sacco_frozen")==="true");
  const [askPin,setAskPin]=React.useState(false);
  const [pin,setPin]=React.useState("");
  const [afterPin,setAfterPin]=React.useState(null);

  React.useEffect(()=>{
    const raw=localStorage.getItem("elites_sacco");
    let parsed=raw?JSON.parse(raw):{};
    MEMBERS.forEach(m=>{
      if(!parsed[m]) parsed[m]={ledger:[],loans:[]};
    });
    if(!Array.isArray(parsed.expenses)) parsed.expenses=[];
    setData(parsed);
  },[]);

  const save=(d)=>{
    setData(d);
    localStorage.setItem("elites_sacco",JSON.stringify(d));
  };

  const requirePin=(action)=>{
    setAfterPin(()=>action);
    setPin("");
    setAskPin(true);
  };

  const verifyPin=()=>{
    if(pin===ADMIN_PIN){
      setAskPin(false);
      afterPin && afterPin();
      setAfterPin(null);
    } else alert("Incorrect PIN");
  };

  if(!user){
    return (
      <div className="p-8 max-w-md mx-auto text-center">
        <h1 className="text-3xl font-bold mb-6">Elites SACCO</h1>
        {MEMBERS.map(m=>(
          <button key={m} className="w-full mb-3 bg-dark text-white p-3 rounded"
            onClick={()=>setUser({name:m,role:m==="Gerald"?"admin":"member"})}>
            Login as {m}
          </button>
        ))}
      </div>
    );
  }

  return (
    <div className="p-4 max-w-6xl mx-auto">
      <header className="bg-dark text-white p-4 rounded-xl mb-4 flex justify-between">
        <div>
          <h1 className="text-2xl font-bold">Elites SACCO</h1>
          <p className="text-gold text-sm">Logged in as {user.name}</p>
        </div>
        <span className={`px-2 py-1 rounded ${frozen?"bg-red-600":"bg-green-600"}`}>
          {frozen?"SYSTEM FROZEN":"SYSTEM ACTIVE"}
        </span>
      </header>

      {user.role==="admin" && (
        <div className="bg-white p-3 rounded mb-4">
          {!frozen ? (
            <button className="bg-red-700 text-white p-2 w-full rounded"
              onClick={()=>requirePin(()=>{localStorage.setItem("sacco_frozen","true");setFrozen(true);})}>
              Freeze System
            </button>
          ) : (
            <button className="bg-green-700 text-white p-2 w-full rounded"
              onClick={()=>requirePin(()=>{localStorage.setItem("sacco_frozen","false");setFrozen(false);})}>
              Unfreeze System
            </button>
          )}
        </div>
      )}

      <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
        {MEMBERS.map(m=>(
          <div key={m} className="bg-white p-4 rounded shadow">
            <h3 className="font-semibold mb-2">{m}</h3>

            {data[m].ledger.map((r,i)=>(
              <div key={i} className="border-b py-1 text-sm flex justify-between">
                <span>{r.month} ‚Äì {r.paid}</span>
                {user.role==="admin" && !frozen && (
                  <div className="space-x-2">
                    <button className="text-blue-600"
                      onClick={()=>requirePin(()=>{
                        const nd={...data};
                        const newPaid=Number(prompt("New amount",r.paid));
                        nd[m].ledger[i].paid=newPaid;
                        save(nd);
                      })}>
                      ‚úèÔ∏è
                    </button>
                    <button className="text-red-600"
                      onClick={()=>requirePin(()=>{
                        if(confirm("Delete this entry?")){
                          const nd={...data};
                          nd[m].ledger.splice(i,1);
                          save(nd);
                        }
                      })}>
                      üóëÔ∏è
                    </button>
                  </div>
                )}
              </div>
            ))}

            {data[m].loans.map((l,i)=>(
              <div key={i} className="text-sm mt-2">
                Loan: {l.currentBalance}
                {user.role==="admin" && !frozen && (
                  <span className="ml-2">
                    <button className="text-red-600"
                      onClick={()=>requirePin(()=>{
                        if(confirm("Delete loan?")){
                          const nd={...data};
                          nd[m].loans.splice(i,1);
                          save(nd);
                        }
                      })}>
                      üóëÔ∏è
                    </button>
                  </span>
                )}
              </div>
            ))}
          </div>
        ))}
      </div>

      {askPin && (
        <div className="fixed inset-0 bg-black bg-opacity-40 flex justify-center items-center">
          <div className="bg-white p-4 rounded max-w-xs w-full">
            <h3 className="font-bold mb-2">Admin PIN</h3>
            <input type="password" className="border p-2 w-full mb-2"
              value={pin} onChange={e=>setPin(e.target.value)} />
            <button className="bg-dark text-white p-2 w-full rounded"
              onClick={verifyPin}>Confirm</button>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);

</script>
</body>
</html>
